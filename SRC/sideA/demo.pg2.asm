
; related to save games
LC5A0:
    .byte $80, $80, $80
LC5A3:
    .byte $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF
    .byte $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF
    .byte $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF

LC5D3:
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00

LC615:
    .byte $38, $4C, $C6, $C6, $C6, $64, $38, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $18, $38, $18, $18, $18, $18, $7E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $C6, $0E, $3C, $78, $E0, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7E, $0C, $18, $3C, $06, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $1C, $3C, $6C, $CC, $FE, $0C, $0C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $C0, $FC, $06, $06, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $3C, $60, $C0, $FC, $C6, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $C6, $0C, $18, $30, $30, $30, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $C6, $C6, $7C, $C6, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $C6, $C6, $7E, $06, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $38, $6C, $C6, $C6, $FE, $C6, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $C6, $C6, $FC, $C6, $C6, $FC, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $3C, $66, $C0, $C0, $C0, $66, $3C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $F8, $CC, $C6, $C6, $C6, $CC, $F8, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $C0, $C0, $FC, $C0, $C0, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $C0, $C0, $FC, $C0, $C0, $C0, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $3E, $60, $C0, $CE, $C6, $66, $3E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $C6, $C6, $FE, $C6, $C6, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7E, $18, $18, $18, $18, $18, $7E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $1E, $06, $06, $06, $C6, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $CC, $D8, $F0, $F8, $DC, $CE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $60, $60, $60, $60, $60, $60, $7E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $EE, $FE, $FE, $D6, $C6, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $E6, $F6, $FE, $DE, $CE, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $C6, $C6, $C6, $C6, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $C6, $C6, $C6, $FC, $C0, $C0, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $C6, $C6, $C6, $DE, $CC, $7A, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $C6, $C6, $CE, $F8, $DC, $CE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $78, $CC, $C0, $7C, $06, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7E, $18, $18, $18, $18, $18, $18, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $C6, $C6, $C6, $C6, $C6, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $C6, $C6, $EE, $7C, $38, $10, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $C6, $D6, $FE, $FE, $EE, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C6, $EE, $7C, $38, $7C, $EE, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $66, $66, $66, $3C, $18, $18, $18, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $0E, $1C, $38, $70, $E0, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $04, $FC, $04, $0C, $18, $70, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $7C, $14, $18, $10, $20, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $04, $18, $70, $10, $10, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $10, $7C, $44, $0C, $38, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $38, $10, $10, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $08, $7C, $18, $28, $48, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $20, $7C, $24, $28, $20, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $38, $08, $08, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $3C, $04, $3C, $04, $3C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $50, $54, $04, $0C, $38, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $02, $26, $3C, $20, $60, $C0, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $06, $0C, $38, $F0, $10, $10, $10, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $FE, $82, $82, $06, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $7C, $10, $10, $10, $10, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $04, $FE, $14, $34, $64, $C4, $0C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $20, $FE, $22, $22, $22, $66, $CC, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $20, $FE, $10, $10, $FE, $08, $08, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7E, $42, $C2, $02, $06, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $40, $7E, $48, $88, $08, $18, $70, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $02, $02, $02, $02, $02, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $44, $FE, $44, $44, $04, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $C0, $04, $C4, $04, $04, $0C, $F8, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $04, $04, $08, $10, $28, $C6, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $40, $FE, $42, $46, $44, $60, $3E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $82, $C2, $42, $06, $0C, $18, $30, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7E, $42, $C2, $1E, $02, $06, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $0C, $78, $08, $FE, $08, $18, $70, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $A2, $A2, $A2, $02, $06, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $00, $FE, $10, $10, $30, $60, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $40, $40, $40, $78, $44, $40, $40, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $10, $FE, $10, $10, $30, $E0, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $00, $00, $00, $00, $00, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FC, $04, $0C, $58, $30, $68, $C4, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $FE, $06, $0C, $38, $56, $92, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $04, $04, $04, $04, $0C, $18, $70, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $18, $0C, $86, $82, $82, $82, $82, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $80, $80, $FC, $80, $80, $C0, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $02, $02, $02, $06, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $70, $98, $8C, $06, $02, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $FE, $10, $10, $92, $92, $92, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $02, $02, $C6, $7C, $30, $18, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $F8, $0E, $60, $38, $0C, $E0, $3E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $30, $60, $40, $C2, $82, $82, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $02, $46, $2C, $18, $30, $68, $C4, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $20, $FE, $20, $20, $30, $1E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $20, $FE, $22, $26, $2C, $20, $20, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $78, $08, $08, $08, $08, $08, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7E, $02, $02, $7E, $02, $02, $7E, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $00, $FE, $02, $02, $06, $7C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $82, $82, $82, $82, $02, $06, $3C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $50, $50, $50, $50, $52, $D6, $1C, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $80, $80, $82, $86, $8C, $98, $F0, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $82, $82, $82, $82, $82, $FE, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $FE, $82, $82, $02, $06, $0C, $78, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $E0, $02, $02, $02, $06, $0C, $F8, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $04, $12, $08, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $07, $05, $07, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $18, $18, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $18, $18, $00, $00, $18, $18, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $18, $18, $00, $00, $18, $18, $08, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $18, $18, $08, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $18, $18, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $3C, $00, $00, $3C, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $3C, $3C, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $20, $40, $40, $40, $40, $20, $10, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $08, $04, $02, $02, $02, $02, $04, $08, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $10, $10, $10, $10, $00, $10, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $7C, $86, $C6, $0C, $10, $00, $10, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $10, $10, $10, $FE, $10, $10, $10, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $06, $0C, $18, $30, $60, $C0, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $1F, $1F, $18, $18, $18
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $F8, $F8, $18, $18, $18
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $FF, $FF, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $18, $18, $18, $18, $18, $18, $18, $18
    .byte $01, $7D, $7D, $7D, $7D, $7D, $01, $FF, $FE, $FE, $FE, $FE, $FE, $FE, $FE, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $18, $18, $18, $1F, $1F, $00, $00, $00
    .byte $00, $00, $00, $00, $00, $00, $00, $00, $18, $18, $18, $F8, $F8, $00, $00, $00

LCE35:
    ldx #<LCF40.b
    ldy #>LCF40.b
    jmp LCE3C
LCE3C:
    stx LCE58
    sty LCE58+1
    jsr LCEDC
LCE45:
    jsr $6CD8
    jsr LCF1D
    jsr $7023
    jsr $DFF3
    LDA #$0E
    jsr FDSBIOS_WriteFile
        .word LCF34
LCE58:
        .word LCF40
    beq LCE62
    jsr LCE90
    jmp LCE45
LCE62:
    jsr LCF27
    rts

LCE66:
    lda #$20
    jsr LCE6E
    jmp ($DFFC) ; reset vector

LCE6E:
    sta LCF3E
LCE71:
    jsr $6CD8
    jsr LCF1D
    jsr $7023
    jsr $DFF3
    jsr FDSBIOS_LoadFiles
        .word LCF34
        .word LCF3E
    beq LCE8C
    jsr LCE90
    jmp LCE71
LCE8C:
    jsr LCF27
    rts

LCE90:
    pha
    jsr LCF27
    pla
    pha
    lsr
    lsr
    lsr
    lsr
    ora #$80
    sta LCF03+7
    pla
    and #$0F
    ora #$80
    sta LCF03+7+1
    jsr $883B
    lda #$12
    sta $1C
    ldx #<LCF03.b
    ldy #>LCF03.b
    jsr $8E39
    jsr LCF27
    jsr $6CD8
    jsr FDSBIOS_EnPFObj
    LCEBE:
        lda DRIVESTATUS
        and #$01
        beq LCEBE
LCEC5:
    lda #$20
    pha
LCEC8:
    jsr $6CD8
    pla
    beq LCED1
    tay
    dey
    tya
LCED1:
    pha
    lda DRIVESTATUS
    and #$01
    bne LCEC8
    pla
    bne LCEC5
LCEDC:
    jsr $883B
    lda #$F4
    sta $0200
    lda #$12
    sta $1C
    ldx #<LCF0D.b
    ldy #>LCF0D.b
    jsr $8E39
    lda PPUCTRL_ZP
    and #$EF
    ora #$08
    sta PPUCTRL_ZP
    sta PPUCTRL
    jsr LCF27
    jsr $6CD8
    jmp FDSBIOS_EnPFObj

; "ERR --" message (disk error)
LCF03:
    PPUString $21F3, \
        $B3, $BA, $BA, $FF, $21, $21
    PPUStringEnd

; "おまちください" message (waiting during disk access)
LCF0D:
    PPUString $21CC, \
        $0B, $0C, $1B, $1C, $2B, $2C, $3F
    PPUString $23DB, \
        $00, $00
    PPUStringEnd

LCF1D:
    lda PPUCTRL_ZP
    and #$7B
LCF21:
    sta PPUCTRL
    sta PPUCTRL_ZP
    rts

LCF27:
    lda PPUSTATUS
    and #PPUSTATUS_VBLK
    bne LCF27
    lda PPUCTRL_ZP
    ora #$80
    bne LCF21 ; branch always

LCF34:
    .byte $01
    .ascstr "MET "
    .byte $02
    .byte $00
    .byte $00
    .byte $00
    .byte $00

LCF3E:
    .byte $00
    .byte $FF

LCF40:
    .byte $0E
    .ascstr $01, $01, $01, $01, $01, $01, $01, $01
    .word $C5A0
    .word $0075
    .byte $00
    .word $C5A0
    .byte $00

LCF51:
    .byte $02, $42, $42, $42, $42, $42, $02, $FF, $B4, $2A, $B2, $02, $B0, $2A, $02



